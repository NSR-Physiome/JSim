#!/bin/bash

# this script compiles a C module for MML F&P
#   this version appropriate for JSim source distribution
# arguments are
#    $1 JSIMHOME
#    $2 directory to build in
#    $3 module name,  without .c extension
#    $4... additional compilation flags

. jsbuild.path
 
# parse command line
if [ $# -lt 3 ]
then
  echo "Usage: jscompile_c JSIMHOME DIR PROG OPTIONS"
  exit 1
fi
export JSIMHOME="$1"
shift
DIR="$1"
shift
NAME="$1"
shift
CFPFLAGS="$*"

# cd DIR
#if [ "$JSIMOS" = "win64" ]
#then
#  DIR=`cygpath -u "$DIR"`
#fi
#echo "DIR=$DIR"

cd $DIR
if [ $? -ne 0 ]
then
  echo "Invalid C compilation directory: $DIR"
  exit 1
fi

# make module.cfp
TARGET="$NAME".cfp
rm -f $TARGET
$JSIMMAKE -f $JSIMSRC/JSim/nonJava/Makefile.global.nml $TARGET
if [ $? -ne 0 ]
then
  echo "C compilation make failed"
  exit 1
fi
